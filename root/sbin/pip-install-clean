#!/bin/bash
# generated by Claude Sonnet 3.5:
# https://claude.ai/share/d3f3a920-be1a-4b13-83d0-de4539ea2d73

# Exit on any error
set -e

# Show usage if no package specified
if [ $# -eq 0 ]; then
    echo "Usage: $0 package_name [additional_pip_args...]"
    echo "Installs a Python package using pip while containing all temporary files"
    echo "Example: $0 requests --upgrade"
    exit 1
fi

# Create temporary home and install directories
TEMP_HOME=$(mktemp -d)
TEMP_INSTALL="$TEMP_HOME/install"
mkdir -p "$TEMP_INSTALL"
echo "Using temporary directory: $TEMP_HOME"

# Function to clean up temp directory on exit
cleanup() {
    local exit_code=$?
    echo "Cleaning up temporary directory..."
    rm -rf "$TEMP_HOME"
    exit $exit_code
}

# Register cleanup function to run on script exit
trap cleanup EXIT

# Run pip with contained home directory, installing to temp location
echo "Installing $1..."
HOME="$TEMP_HOME" python3 -m pip install --prefix="$TEMP_INSTALL" "$@"

# Copy executables from local/bin if they exist
if [ -d "$TEMP_INSTALL/local/bin" ]; then
    echo "Copying executables to /usr/local/bin..."
    sudo cp "$TEMP_INSTALL/local/bin"/* /usr/local/bin/
fi

echo "Installation complete. Temporary files will be cleaned up automatically."
