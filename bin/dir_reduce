#! /usr/bin/env perl

use 5.12.0;
use warnings;

use Data::Printer;
use File::Basename;


my @files = <>;
chomp @files;

my $files = reduce_list( { map { $_ => 1 } @files }, 1 );
while (1)
{
	my $count = keys %$files;
	$files = reduce_list($files, 5);
	last if keys %$files = $count;
}

say foreach sort keys %$files;


sub reduce_list
{
	my ($files, $limit) = @_;
	#say "before:"; p $files;

	my %parents;
	$parents{dirname $_}++ foreach keys %$files;
	foreach my $file (keys %$files)
	{
		my $parent = dirname $file;
		if ($parents{$parent} >= $limit)
		{
			delete $files->{$file};
			++$files->{$parent};
		}
	}

	#say "after:"; p $files;
	return $files;
}
