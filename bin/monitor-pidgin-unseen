#! /usr/bin/env perl

use myperl::Pxb;
use autodie ':all';


opts <<'-';
	[-q]
	-q : if no incoming messages found, just exit silently
-

$ENV{DISPLAY} //= ':0.0';

my $remote_host = shift;


if ($remote_host)
{
	bash ssh => $remote_host, $ME => '-q' ? say "message!" : "no message :-(";
}
else
{
	# red, bold, reverse, blink
	const my $ON  => "\e[31;1;7;5m";
	const my $OFF => "\e[0m";

	my $found = 0;
	foreach (sh(wmctrl => -l =>))
	{
		my ($wid) = split(' ');
		my $info = sh(xprop => -id => $wid);
		if ( $info =~ /urgency hint bit/ )
		{
			$info =~ /WM_NAME\(STRING\)\s*=\s*"(.*?)"/ and say "$ON$1$OFF";
			$found = 1;
		}
	}
	print "\n", sh(date => '+"     %m/%d/%Y  %I:%M%P"') unless $found or $OPT{q};
}
