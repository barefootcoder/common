#! /usr/bin/perl

use 5.14.0;
use autodie ':all';
use warnings FATAL => 'all';

use Text::Tabs; $tabstop = 4;


my $in_pre = 0;
while (<>)
{
	$_ = expand($_);
	s/^  (\s*\*\s+)/$1/;												# bullet lists
	s/^  (\s*)#(\s+)/${1}1.$2/;											# numbered lists

	s/\*\b(.+?)\b\*/'''$1'''/g;											# bold
	s/(^|\W)_(.+?)_(\W|$)/$1''$2''$3/g;									# italics

	if (/^\s+(.)/ and $1 ne '*' and not $in_pre)
	{
		say '{{{';
		$in_pre = 1;
	}
	elsif ($in_pre and /^$/)
	{
		say '}}}';
		$in_pre = 0;
	}

	print;
}
